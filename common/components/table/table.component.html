@let cfg = config();

@if (cfg.search) {
  <mat-form-field class="search">
    <mat-label> {{ "SEARCH" | translate }} ({{ cfg.search.fieldHeaders | textConfigTranslate }}) </mat-label>
    <input #searchInput matInput />
  </mat-form-field>
}

<div class="table-margin mat-elevation-z8">
  @if (shouldShowSpinner) {
    <div class="spinner-overlay">
      <mat-spinner />
    </div>
  }

  @if (isMobile()) {
    <div class="mobile-list">
      @if (isTableEmpty) {
        <div class="empty-table-cell">{{ "EMPTY_TABLE" | translate }}</div>
      }

      @for (row of dataSource.response.items; track row) {
        <div
          class="mobile-card mat-elevation-z2"
          appTableRowInteraction
          [row]="row"
          [markRowCondition]="cfg.markRowCondition"
        >
          <div class="mobile-card__content">
            <div class="mobile-card__fields">
              @for (column of cfg.columns; track column.columnDef) {
                <div class="mobile-card__row">
                  <span class="mobile-card__label">{{ column.header | textConfigTranslate }}</span>
                  <span class="mobile-card__value">
                    <app-table-row [column]="column" [row]="row" />
                  </span>
                </div>
              }
            </div>

            @if (cfg.columnsWithIcon.length || cfg.actionsDefinition) {
              <div class="mobile-card__actions">
                <app-table-row-actions
                  [tableComponent]="this"
                  [data]="row.data!"
                  [columnsWithIcon]="cfg.columnsWithIcon"
                  [actionsDefinition]="cfg.actionsDefinition"
                  [disabled]="shouldShowSpinner"
                />
              </div>
            }
          </div>
        </div>
      }
    </div>
  } @else {
    <mat-table
      [class.disable-table]="shouldShowSpinner"
      [dataSource]="dataSource"
      matSort
      (matSortChange)="onSortChange($event)"
    >
      @for (column of cfg.columns; track column.columnDef) {
        <ng-container
          [matColumnDef]="column.columnDef"
          [sticky]="column.sticky"
          [stickyEnd]="column.stickyEnd"
        >
          <mat-header-cell *matHeaderCellDef [style]="'min-width:' + column.minWidth" mat-sort-header>
            {{ column.header | textConfigTranslate }}
          </mat-header-cell>
          <mat-cell *matCellDef="let row" [style]="'min-width:' + column.minWidth">
            <app-table-row [column]="column" [row]="row" />
          </mat-cell>
        </ng-container>
      }

      @for (column of cfg.columnsWithIcon; track column.columnName) {
        <ng-container [matColumnDef]="column.columnName">
          <mat-header-cell *matHeaderCellDef class="action-column-width" />
          <mat-cell *matCellDef="let row" class="action-column-width">
            <button
              mat-icon-button
              class="action-button"
              [disabled]="shouldShowSpinner"
              (click)="$event.stopPropagation(); column.onClick(row.data)"
            >
              <mat-icon>{{ column.icon }}</mat-icon>
            </button>
          </mat-cell>
        </ng-container>
      }

      @if (cfg.actionsDefinition) {
        <ng-container
          [matColumnDef]="cfg.actionsDefinition.name"
          [stickyEnd]="cfg.actionsDefinition.stickyEnd"
        >
          <mat-header-cell *matHeaderCellDef class="action-column-width" />
          <mat-cell *matCellDef="let row" class="action-column-width">
            <app-table-actions-definition
              [tableComponent]="this"
              [actionsDefinition]="cfg.actionsDefinition"
              [data]="row.data!"
              [shouldShowSpinner]="shouldShowSpinner"
            />
          </mat-cell>
        </ng-container>
      }

      <ng-container matColumnDef="tableIsEmptyColumn">
        <mat-footer-cell *matFooterCellDef class="empty-table-cell">
          <span>{{ "EMPTY_TABLE" | translate }}</span>
        </mat-footer-cell>
      </ng-container>

      <mat-header-row *matHeaderRowDef="cfg.columnNames; sticky: cfg.headerSticky" />
      <mat-row
        *matRowDef="let row; columns: cfg.columnNames"
        appTableRowInteraction
        [row]="row"
        [markRowCondition]="cfg.markRowCondition"
      />
      <mat-footer-row
        *matFooterRowDef="['tableIsEmptyColumn']"
        class="empty-table"
        [class.hide-element]="!isTableEmpty"
      />
    </mat-table>
  }

  @if (cfg.paginator) {
    <mat-paginator
      class="pt-2"
      [pageSizeOptions]="cfg.paginator.getPageSizes()"
      [pageSize]="dataSource.response.pagination.pageSize"
      [pageIndex]="dataSource.response.pagination.pageNumber - 1"
      [showFirstLastButtons]="cfg.paginator.showFirstLastButtons"
      [length]="dataSource.response.totalCount"
      (page)="onPageChange($event)"
    />
  }
</div>
